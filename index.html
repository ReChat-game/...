<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>...</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="particleCanvas"></canvas>
  <canvas id="heartParticlesCanvas"></canvas>

  <button id="heartButton">Clique aqui</button>

  <div id="loveText">
    <span id="typewriterText"></span>
  </div>

  <script>
    const canvas = document.getElementById("particleCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const heartCanvas = document.getElementById("heartParticlesCanvas");
    const heartCtx = heartCanvas.getContext("2d");
    heartCanvas.width = window.innerWidth;
    heartCanvas.height = window.innerHeight;

    const particles = [];
    const numParticles = 300;
    let inHeartMode = false;
    let showTextStarted = false;

    for (let i = 0; i < numParticles; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: 3,
        speedY: 0.3 + Math.random() * 0.5,
        tx: null,
        ty: null,
      });
    }

    function generateHeartPoints() {
      const points = [];
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const scale = 10;

      for (let t = 0; t < Math.PI * 2; t += 0.05) {
        const x = scale * 16 * Math.pow(Math.sin(t), 3);
        const y =
          -scale *
          (13 * Math.cos(t) -
            5 * Math.cos(2 * t) -
            2 * Math.cos(3 * t) -
            Math.cos(4 * t));
        points.push({ x: centerX + x, y: centerY + y });
      }

      return points;
    }

    const heartPoints = generateHeartPoints();

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      heartCtx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);

      let allInPlace = true;

      for (let i = 0; i < particles.length; i++) {
        const p = particles[i];

        if (inHeartMode && p.tx !== null && p.ty !== null) {
          const dx = p.tx - p.x;
          const dy = p.ty - p.y;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist > 2) allInPlace = false;

          p.x += dx * 0.02;
          p.y += dy * 0.02;
        } else {
          p.y += p.speedY;
          if (p.y > canvas.height) {
            p.y = -10;
            p.x = Math.random() * canvas.width;
          }
        }

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = "#ff69b4";
        ctx.fill();
      }

      if (inHeartMode && allInPlace && !showTextStarted) {
        showTextStarted = true;
        showText();
      }

      requestAnimationFrame(animate);
    }

    function showText() {
      const loveText = document.getElementById("loveText");
      loveText.style.opacity = 1;

      const message = "Ã‰ que\n eu te amo...";
      const typewriter = document.getElementById("typewriterText");
      let i = 0;

      const type = () => {
        if (i < message.length) {
          typewriter.textContent += message[i];
          i++;
          setTimeout(type, 100);
        }
      };
      type();
    }

    document.getElementById("heartButton").addEventListener("click", () => {
      const heartButton = document.getElementById("heartButton");
      heartButton.style.transition = "opacity 1s ease";
      heartButton.style.opacity = "0";
      setTimeout(() => heartButton.remove(), 1000);

      const mappedPoints = heartPoints.slice(0, particles.length);
      for (let i = 0; i < particles.length; i++) {
        particles[i].tx = mappedPoints[i % mappedPoints.length].x;
        particles[i].ty = mappedPoints[i % mappedPoints.length].y;
      }

      inHeartMode = true;
    });

    setTimeout(() => {
      document.getElementById("heartButton").style.opacity = 1;
    }, 3000);

    animate();
  </script>
</body>
</html>
